<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Basketball Court</title>
    <meta name="description" content="VR Basketball Court">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/supermedium/superframe@master/components/environment/dist/aframe-environment-component.min.js"></script>
    <style>
        #menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }
        #menu button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        #menu button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <!-- Menu UI -->
    <div id="menu">
        <h2>VR Basketball Menu</h2>
        <button onclick="spawnBot()">Spawn Defensive Bot</button>
        <button onclick="resetBalls()">Clear All Balls</button>
        <button onclick="closeMenu()">Close Menu</button>
    </div>

    <a-scene vr-mode-ui="enabled: true" stats>
        <!-- Assets -->
        <a-assets>
            <a-mixin id="basketball"
                geometry="primitive: sphere; radius: 0.12"
                material="color: #FF6600; roughness: 0.8"
                dynamic-body="mass: 0.6; linearDamping: 0.1; angularDamping: 0.3"
                grabbable>
            </a-mixin>
        </a-assets>

        <!-- Environment and Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 10 5" color="#FFF" intensity="0.8" cast-shadow></a-light>

        <!-- Basketball Court -->
        <!-- Court Floor -->
        <a-box id="court-floor" 
            position="0 0 0" 
            width="28" 
            height="0.1" 
            depth="15" 
            material="color: #8B4513; roughness: 0.6"
            static-body>
        </a-box>

        <!-- Court Lines -->
        <a-box position="0 0.06 0" width="28" height="0.02" depth="0.1" material="color: white"></a-box>
        <a-box position="0 0.06 0" width="0.1" height="0.02" depth="15" material="color: white"></a-box>
        <a-box position="14 0.06 0" width="0.1" height="0.02" depth="15" material="color: white"></a-box>
        <a-box position="-14 0.06 0" width="0.1" height="0.02" depth="15" material="color: white"></a-box>
        <a-box position="0 0.06 7.5" width="28" height="0.02" depth="0.1" material="color: white"></a-box>
        <a-box position="0 0.06 -7.5" width="28" height="0.02" depth="0.1" material="color: white"></a-box>

        <!-- Free Throw Lines -->
        <a-cylinder position="12 0.06 0" radius="1.8" height="0.02" material="color: white; side: double" 
            geometry="openEnded: true; thetaStart: 0; thetaLength: 180"></a-cylinder>
        <a-cylinder position="-12 0.06 0" radius="1.8" height="0.02" material="color: white; side: double" 
            geometry="openEnded: true; thetaStart: 180; thetaLength: 180"></a-cylinder>

        <!-- Center Circle -->
        <a-ring position="0 0.06 0" radius-inner="1.8" radius-outer="1.9" material="color: white; side: double"></a-ring>

        <!-- Basketball Hoops -->
        <!-- Left Hoop -->
        <a-cylinder position="-12 3 0" radius="0.23" height="0.05" material="color: #FF4500" 
            rotation="90 0 0" open-ended="true"></a-cylinder>
        <a-box position="-12.5 3 0" width="0.05" height="0.6" depth="0.4" material="color: white; opacity: 0.7"></a-box>
        <a-cylinder position="-12.5 3 0" radius="0.02" height="3.5" material="color: #333"></a-cylinder>
        
        <!-- Right Hoop -->
        <a-cylinder position="12 3 0" radius="0.23" height="0.05" material="color: #FF4500" 
            rotation="90 0 0" open-ended="true"></a-cylinder>
        <a-box position="12.5 3 0" width="0.05" height="0.6" depth="0.4" material="color: white; opacity: 0.7"></a-box>
        <a-cylinder position="12.5 3 0" radius="0.02" height="3.5" material="color: #333"></a-cylinder>

        <!-- Hoop Nets (simplified) -->
        <a-cone position="-12 2.8 0" radius-bottom="0.23" radius-top="0.15" height="0.3" 
            material="color: white; opacity: 0.3; wireframe: true"></a-cone>
        <a-cone position="12 2.8 0" radius-bottom="0.23" radius-top="0.15" height="0.3" 
            material="color: white; opacity: 0.3; wireframe: true"></a-cone>

        <!-- Defensive Bot (initially hidden) -->
        <a-entity id="bot" visible="false" position="5 0.1 0">
            <!-- Bot Body -->
            <a-box position="0 1 0" width="0.6" height="1.8" depth="0.3" material="color: #FF0000"></a-box>
            <!-- Bot Head -->
            <a-sphere position="0 2.2 0" radius="0.3" material="color: #FFB366"></a-sphere>
            <!-- Bot Arms -->
            <a-box position="0.4 1.5 0" width="0.8" height="0.2" depth="0.2" material="color: #FF0000"></a-box>
            <a-box position="-0.4 1.5 0" width="0.8" height="0.2" depth="0.2" material="color: #FF0000"></a-box>
        </a-entity>

        <!-- Sky -->
        <a-sky color="#87CEEB"></a-sky>

        <!-- Ground around court -->
        <a-plane position="0 -0.05 0" rotation="-90 0 0" width="100" height="100" color="#228B22"></a-plane>

        <!-- Player Camera Rig -->
        <a-entity id="cameraRig" position="0 0.1 5">
            <a-entity camera 
                look-controls 
                wasd-controls="enabled: false"
                position="0 1.6 0">
            </a-entity>
            
            <!-- VR Controllers -->
            <a-entity id="leftController" 
                laser-controls="hand: left" 
                raycaster="objects: .grabbable">
            </a-entity>
            
            <a-entity id="rightController" 
                laser-controls="hand: right" 
                raycaster="objects: .grabbable">
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        // Basketball tracking
        let basketballs = [];
        let botEntity = null;
        let botActive = false;
        let playerPosition = {x: 0, y: 0.1, z: 5};
        let isJumping = false;
        let jumpVelocity = 0;
        let menuOpen = false;

        // Initialize after scene loads
        document.querySelector('a-scene').addEventListener('loaded', function () {
            setupControllers();
            setupPhysics();
            startGameLoop();
        });

        function setupPhysics() {
            // Simple physics setup
            const scene = document.querySelector('a-scene');
            scene.setAttribute('physics', 'gravity: -9.8; debug: false');
        }

        function setupControllers() {
            const leftController = document.querySelector('#leftController');
            const rightController = document.querySelector('#rightController');
            const cameraRig = document.querySelector('#cameraRig');

            // Right controller - B button to spawn basketball
            rightController.addEventListener('bbuttondown', function() {
                spawnBasketball();
            });

            // Right controller - A button to jump
            rightController.addEventListener('abuttondown', function() {
                jump();
            });

            // Left controller - Menu button (3 lines)
            leftController.addEventListener('menudown', function() {
                toggleMenu();
            });

            // Thumbstick movement
            rightController.addEventListener('thumbstickmoved', function(evt) {
                movePlayer(evt.detail.x, evt.detail.y);
            });

            // Alternative controls for Quest controllers
            document.addEventListener('keydown', function(evt) {
                if (evt.key === 'b' || evt.key === 'B') spawnBasketball();
                if (evt.key === 'a' || evt.key === 'A') jump();
                if (evt.key === 'm' || evt.key === 'M') toggleMenu();
            });
        }

        function spawnBasketball() {
            const scene = document.querySelector('a-scene');
            const cameraRig = document.querySelector('#cameraRig');
            const camera = document.querySelector('[camera]');
            
            // Get spawn position in front of player
            const position = cameraRig.getAttribute('position');
            const rotation = camera.getAttribute('rotation');
            
            // Calculate spawn position
            const distance = 1;
            const spawnX = position.x - Math.sin(rotation.y * Math.PI / 180) * distance;
            const spawnY = position.y + 1.5;
            const spawnZ = position.z - Math.cos(rotation.y * Math.PI / 180) * distance;
            
            // Create basketball
            const basketball = document.createElement('a-sphere');
            basketball.setAttribute('radius', '0.12');
            basketball.setAttribute('position', `${spawnX} ${spawnY} ${spawnZ}`);
            basketball.setAttribute('material', 'color: #FF6600; roughness: 0.8');
            basketball.setAttribute('class', 'basketball grabbable');
            
            // Add simple physics behavior
            basketball.setAttribute('data-velocity', '0 0 0');
            
            scene.appendChild(basketball);
            basketballs.push(basketball);
            
            // Remove old basketballs if too many
            if (basketballs.length > 10) {
                const oldBall = basketballs.shift();
                oldBall.remove();
            }
        }

        function movePlayer(x, y) {
            const cameraRig = document.querySelector('#cameraRig');
            const position = cameraRig.getAttribute('position');
            
            // Movement speed
            const speed = 0.1;
            
            // Update position based on thumbstick
            position.x += x * speed;
            position.z -= y * speed;
            
            // Keep player within court bounds
            position.x = Math.max(-13, Math.min(13, position.x));
            position.z = Math.max(-7, Math.min(7, position.z));
            
            playerPosition = position;
            cameraRig.setAttribute('position', position);
        }

        function jump() {
            if (!isJumping) {
                isJumping = true;
                jumpVelocity = 0.2;
            }
        }

        function toggleMenu() {
            menuOpen = !menuOpen;
            document.getElementById('menu').style.display = menuOpen ? 'block' : 'none';
        }

        function closeMenu() {
            menuOpen = false;
            document.getElementById('menu').style.display = 'none';
        }

        function spawnBot() {
            botEntity = document.querySelector('#bot');
            botEntity.setAttribute('visible', true);
            botActive = true;
            closeMenu();
        }

        function resetBalls() {
            basketballs.forEach(ball => ball.remove());
            basketballs = [];
            closeMenu();
        }

        function updateBot() {
            if (!botActive || !botEntity) return;
            
            const botPos = botEntity.getAttribute('position');
            const playerPos = playerPosition;
            
            // Simple AI - move towards player
            const dx = playerPos.x - botPos.x;
            const dz = playerPos.z - botPos.z;
            const distance = Math.sqrt(dx * dx + dz * dz);
            
            if (distance > 2) {
                // Move towards player
                botPos.x += (dx / distance) * 0.05;
                botPos.z += (dz / distance) * 0.05;
            }
            
            // Bot jumping when player is close and jumping
            if (distance < 3 && isJumping && Math.random() > 0.7) {
                botPos.y = Math.min(2, botPos.y + 0.3);
            } else {
                botPos.y = Math.max(0.1, botPos.y - 0.1);
            }
            
            botEntity.setAttribute('position', botPos);
        }

        function updatePhysics() {
            // Update jumping
            if (isJumping) {
                const cameraRig = document.querySelector('#cameraRig');
                const position = cameraRig.getAttribute('position');
                
                position.y += jumpVelocity;
                jumpVelocity -= 0.01; // Gravity
                
                if (position.y <= 0.1) {
                    position.y = 0.1;
                    isJumping = false;
                    jumpVelocity = 0;
                }
                
                cameraRig.setAttribute('position', position);
                playerPosition = position;
            }
            
            // Simple ball physics
            basketballs.forEach(ball => {
                if (!ball.parentNode) return;
                
                const pos = ball.getAttribute('position');
                let velocity = ball.getAttribute('data-velocity');
                if (!velocity) velocity = '0 -0.1 0';
                
                const vel = velocity.split(' ').map(Number);
                
                // Apply gravity
                vel[1] -= 0.01;
                
                // Update position
                pos.x += vel[0];
                pos.y += vel[1];
                pos.z += vel[2];
                
                // Bounce off ground
                if (pos.y <= 0.12) {
                    pos.y = 0.12;
                    vel[1] = -vel[1] * 0.7; // Bounce with damping
                    vel[0] *= 0.9; // Friction
                    vel[2] *= 0.9;
                }
                
                // Court bounds
                if (Math.abs(pos.x) > 14) {
                    vel[0] = -vel[0] * 0.8;
                    pos.x = Math.sign(pos.x) * 14;
                }
                if (Math.abs(pos.z) > 7.5) {
                    vel[2] = -vel[2] * 0.8;
                    pos.z = Math.sign(pos.z) * 7.5;
                }
                
                ball.setAttribute('position', pos);
                ball.setAttribute('data-velocity', vel.join(' '));
            });
        }

        function startGameLoop() {
            setInterval(() => {
                updatePhysics();
                updateBot();
            }, 16); // ~60 FPS
        }
    </script>
</body>
</html>
